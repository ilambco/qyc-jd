(()=>{"use strict";var e,t,n,a,o,l={3123:(e,t,n)=>{var a=n(96540),o=n(85072),l=n.n(o),r=n(97825),i=n.n(r),s=n(77659),c=n.n(s),d=n(55056),u=n.n(d),m=n(10540),g=n.n(m),h=n(41113),p=n.n(h),f=n(47262),w={};w.styleTagTransform=p(),w.setAttributes=u(),w.insert=c().bind(null,"head"),w.domAPI=i(),w.insertStyleElement=g();l()(f.A,w);f.A&&f.A.locals&&f.A.locals;var b=n(20921),E=n(53356),v=n(29100),x=n(32483),A=n(72916);const k=a.createContext({access_token:"",setAccess_token:()=>{},userInfo:null,setUserInfo:()=>{}});var y=n(5338),C=n(38164),I={};I.styleTagTransform=p(),I.setAttributes=u(),I.insert=c().bind(null,"head"),I.domAPI=i(),I.insertStyleElement=g();l()(C.A,I);C.A&&C.A.locals&&C.A.locals;var S=n(63518),z=n(62214),_=(n(10064),n(48268)),R=n(78291),O=n(69),P=n(20264),T=n(96921),D=n(2543),M=n(25279);function L(e){let t=e.lastIndexOf("/"),n=e.lastIndexOf(".");return-1==n&&(n=e.length),e.substring(t+1,n)}function $(e){return e.replace(/[~\\\/:\*\?"<>|\u200b]/g,"_").replace(/^\.+/,"").replace(/\.+$/,"").replace(/^\s*(.*?)\s*$/,"$1")}function B(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours()%12==0?12:e.getHours()%12,"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+{0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"}[e.getDay()+""])),n)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?n[a]+"":("00"+n[a]).substr((""+n[a]).length)));return t}var j=n(86185);let W="";var H;chrome.storage.local.get("defaultDownloadLocation",e=>{e.defaultDownloadLocation&&(W=e.defaultDownloadLocation)}),function(e){e.OK="ok",e.FAILED="failed"}(H||(H={}));class F{constructor(e,t){this.id="",this.loaded=!1,this.width=0,this.height=0,this.contentType="",this.isSelected=!0,this.hdSrc="",this.src="",this.thumbnail="",this.indexInPage=-1,this.group="",this.groupIndex=-1,this.alt="",this.type="IMAGE",this.downloaded=!1,this.downloadId=-1,this.pinId="",this.error="",this.requestId="",this.docTitle="",this.itemId="",this.downloadState=void 0,Object.assign(this,e),this.tab=t,this.id=(0,M.A)()}toObject(){return{src:this.src,hdSrc:this.hdSrc,indexInPage:this.indexInPage,alt:this.alt,group:this.group,groupIndex:this.groupIndex,type:this.type,thumbnail:this.thumbnail,width:this.width,height:this.height,docTitle:this.docTitle,itemId:this.itemId,productInfo:this.productInfo}}setSize(e,t){this.width=e,this.height=t}getExt(){let e=this.contentType&&this.contentType.split("/")[1].toUpperCase().split(";")[0].toLocaleLowerCase()||function(e){let t=e.match(/.*\.([a-zA-Z]+)/);return t?t[1]:""}(this.hdSrc);e=e.toLocaleLowerCase(),"jpeg"==e&&(e="jpg");return["jpg","png","webp","gif","jpeg","mp4","avif"].indexOf(e.toLowerCase())>=0?e:"unknown"}setContentType(e){this.contentType=e}getContentType(){return this.contentType}toggleSelected(){this.isSelected=!this.isSelected}getFilename(e,t){let n=this.getFileNameExt(e);"unknown"!=n&&"jpeg"!=n||(n="jpg");let a=this.alt||L(this.hdSrc);a=$(a);let o="";o=e.rename.enabled?(0,j.gY)(e.rename.rule,{ext:n,name:a,ptitle:$(this.docTitle||this.tab.title),itemId:this.itemId,link:this.hdSrc,index:null!=t?t:this.indexInPage,group:this.group,groupIndex:this.groupIndex,date:B(new Date,"yyyyMMdd_HHmmss"),width:this.width,height:this.height,domain:new URL(this.hdSrc).host}):`${$("useFixedName"==e.saveDir.dirType&&e.saveDir.fixedDir||this.docTitle||this.tab.title)}/${a}.${n}`;const l=o.length+(W.length||40)-240;if(l>0){let e=o.split("/");e[0].length>l&&(e[0]=e[0].substring(0,e[0].length-l)),o=e.join("/")}return o}getFileNameExt(e){let t=this.getExt();return"VIDEO"!==this.type&&(e.webpTo.enabled&&(t=e.webpTo.type),e.avifTo.enabled&&(t=e.avifTo.type)),t}getOutputText(e){let t=this.getExt(),n=this.alt||L(this.hdSrc);n=$(n);let a="";return a=(0,j.gY)(e,{ext:t,name:n,width:this.width,height:this.height,domain:new URL(this.hdSrc).host,ptitle:$(this.docTitle||this.tab.title),itemId:this.itemId,link:this.hdSrc,index:this.indexInPage,group:this.group,groupIndex:this.groupIndex,date:B(new Date,"yyyyMMdd_HHmmss")}),a}getJpgOrPng(e,t){let n=new OffscreenCanvas(this.width,this.height),a=new Image;a.onload=async function(){let o=n.getContext("2d");o&&o.drawImage(a,0,0);let l=await n.convertToBlob({type:`image/${e}`}),r=URL.createObjectURL(l);t(r)},a.src=this.hdSrc}zipDownload(e,t,n,a){return fetch(this.hdSrc,{signal:n}).then(e=>{if(e.ok)return e.arrayBuffer();throw new Error("Not 2xx response")}).then(n=>(this.fetchStatus=H.OK,a(),{file:n,filename:this.getFilename(e,t.index),status:H.OK,url:this.hdSrc})).catch(e=>(a(),this.fetchStatus=H.FAILED,{status:H.FAILED,url:this.hdSrc}))}downloadAgainWhenInvalidName(e){chrome.downloads.download({url:e},e=>{this.downloadId=e})}_downloadFile(e,t){chrome.downloads.download({url:e,filename:t},t=>{chrome.runtime.lastError?"Invalid filename"===chrome.runtime.lastError.message&&this.downloadAgainWhenInvalidName(e):t&&(this.downloadId=t)})}async download(e){const{[T.V2]:t}=await chrome.storage.local.get(T.V2);if(!t)return;const n=this.getFilename(t,null==e?void 0:e.index);let a;if(this.downloadWidth)a=(0,j.F_)(this.hdSrc,this.downloadWidth);else if("custom"===t.downloadSize.type)a=(0,j.F_)(this.hdSrc,t.downloadSize.width);else{const e=this.getExt(),{webpTo:n,avifTo:o}=t;a="webp"===e&&n.enabled?new Promise(e=>this.getJpgOrPng(n.type,e)):"avif"===e&&o.enabled?new Promise(e=>this.getJpgOrPng(o.type,e)):Promise.resolve(this.hdSrc)}const o=await a;"custom"===t.downloadSize.type&&console.log(o),this._downloadFile(o,n)}getBase64(){return new Promise(e=>{this.hdSrc.match("^data:")?e(this.hdSrc):(0,j.AN)(this.hdSrc).then(t=>{e(t)})})}}var N=n(78746);var V=n(71710),U=n.n(V),K=n(48742),G=n(35124);const q=e=>{const{t}=(0,R.Bd)(["output"]);return a.createElement(v.A,{sx:{textAlign:"center"}},e.imgs.filter(e=>!e.fetchStatus).length>0?a.createElement(a.Fragment,null,a.createElement(G.A,{variant:"h5"},t("zip_download_tip_downloading","Downloading images, please wait...")),a.createElement(v.A,{sx:{m:2}},a.createElement(G.A,{sx:{mb:1}},t("zip_download_slow_img_tip","If the download is slow, you can click the button below to download the images that have already been cached.")),a.createElement(K.A,{variant:"contained",onClick:e.instantDownload},t("zip_download_instant_download","Download Now")))):a.createElement(a.Fragment,null,a.createElement(G.A,{variant:"h5"},t("zip_download_tip_completed","All images have been packaged into a zip file and downloaded.")),a.createElement(K.A,{sx:{m:2},variant:"contained",onClick:()=>{chrome.downloads.show(e.downloadId)}},t("zip_download_tip_open_folder","Open Folder"))),a.createElement(G.A,{variant:"h5"},a.createElement("span",{style:{textTransform:"capitalize"}},t("total","Total")),":",e.imgs.length,"/",a.createElement("span",{style:{textTransform:"capitalize"}},t("successed","Successed")),":",e.imgs.filter(e=>e.fetchStatus==H.OK).length,"/",a.createElement("span",{style:{textTransform:"capitalize"}},t("failed","Failed")),":",e.imgs.filter(e=>e.fetchStatus==H.FAILED).length))};var Y=n(63625);var X=n(97938),Z=n(57599),Q=n(26773),J=n(85916),ee=n(25418),te=n(53830),ne=n(4126),ae=n(88634),oe=n(79672),le=n(57862),re=n(42116),ie=n(30073),se=n(95884),ce=n(16738),de=n(21079);const ue='<img src="{LINK}" />',me=e=>{const{t}=(0,R.Bd)(["output"]),[n,o]=a.useState(ue),[l,r]=a.useState([]),[i,s]=a.useState(null),[c,d]=a.useState(!1),u=a.createRef(),m=a.createRef(),g=Boolean(i),h=e=>{o(e),s(null)};return a.useEffect(()=>{chrome.storage.local.get(["format-history"],e=>{e["format-history"]&&r(e["format-history"])})},[]),a.createElement(Q.A,{open:e.open,onClose:e.onClose},a.createElement(J.A,null,e.title),a.createElement(ee.A,{sx:{pb:0}},a.createElement(te.A,{sx:{"& .MuiTextField-root":{m:1,width:"30rem"}}},a.createElement(ne.A,{label:t("format","Format"),variant:"standard",placeholder:ue,value:n,onChange:e=>{o(e.target.value)},inputRef:u,helperText:t("linkExportPanelHelper","{LINK} is a placeholder for the image address, and renaming placeholders can also be used here"),InputProps:{endAdornment:a.createElement(ae.A,{position:"end"},a.createElement(x.A,{onClick:()=>{u.current&&s(u.current)}},a.createElement(X.A,null)))}}),a.createElement(v.A,{sx:{position:"relative"}},a.createElement(ne.A,{multiline:!0,inputRef:m,maxRows:10,disabled:!0,value:e.imgs.map(e=>e.getOutputText(n)).join("\n")}),a.createElement(v.A,{sx:{position:"absolute",top:0,left:0,display:c?"flex":"none",bgcolor:(0,oe.X4)(de.A[50],.5),color:"success.main",textAlign:"center",lineHeight:"15rem",m:1,height:"calc(100% - 16px)",width:"calc(100% - 16px)",alignItems:"center",justifyContent:"center"}},a.createElement(G.A,{variant:"body1"},t("copiedToClipboard","Copied to clipboard!")))))),a.createElement(le.A,null,a.createElement(K.A,{onClick:()=>{navigator.clipboard.writeText(m.current.value),d(!0),setTimeout(d.bind(void 0,!1),3e3);let e=l.indexOf(n);e>=0&&l.splice(e,1),l.unshift(n),r(Array.from(l)),chrome.storage.local.set({"format-history":l})}},t("copy","Copy"))),a.createElement(re.Ay,{open:g,anchorEl:i,anchorOrigin:{vertical:"bottom",horizontal:"left"},disablePortal:!0,onClose:()=>{s(null)}},a.createElement(ie.A,{dense:!0,sx:{width:"30rem"}},l.map((e,t)=>a.createElement(se.A,{key:t,onClick:h.bind(void 0,e),sx:{"&:hover .MuiSvgIcon-root":{display:"block"}}},a.createElement(ce.A,null,e),a.createElement(Z.A,{onClick:e=>{var n;n=t,e.stopPropagation(),l.splice(n,1),r(Array.from(l)),chrome.storage.local.set({"format-history":l})},sx:{display:"none",borderRadius:"100%",fontSize:"14px",padding:"2px","&:hover":{background:"rgba(0, 0, 0, 0.05)"}}}))))))};var ge=n(35343),he={};he.styleTagTransform=p(),he.setAttributes=u(),he.insert=c().bind(null,"head"),he.domAPI=i(),he.insertStyleElement=g();l()(ge.A,he);ge.A&&ge.A.locals&&ge.A.locals;var pe=n(29184),fe=n(29525),we=n(97411),be=n(38719),Ee=n(68669),ve=n(30499),xe=n(8862),Ae=n(50412),ke=n(63083),ye=n(15548),Ce=n(65652),Ie=n(5076),Se=n(29608),ze=n(71398);function _e(e){const{children:t,value:n}=e;return a.createElement(Ce.A,{arrow:!0,enterTouchDelay:0,placement:"bottom",title:n},t)}chrome.i18n.getMessage;const Re=e=>{const{t}=(0,R.Bd)(["output"]),[n,o]=a.useState(null),l=t=>{console.log(t.currentTarget.name);const n=t.currentTarget.name;var a=[];"minWidth"==n?a=[parseInt(t.target.value||"0"),e.size.widthRange[1]||e.size.maxWidth]:"maxWidth"==n?a=[e.size.widthRange[0]||0,parseInt(t.target.value||"0")]:"minHeight"==n?a=[parseInt(t.target.value||"0"),e.size.heightRange[1]||e.size.maxHeight]:"maxHeight"==n&&(a=[e.size.heightRange[0]||0,parseInt(t.target.value||"0")]),n.includes("Width")?e.handleWidthRangeChange(a):e.handleHeightRangeChange(a)},r=Boolean(n);return a.createElement(te.A,{direction:"row",spacing:2,sx:{}},[{title:t("width","Width"),value:e.size.widthRange,onChange:e.handleWidthRangeChange,max:e.size.maxWidth},{title:t("height","Height"),value:e.size.heightRange,onChange:e.handleHeightRangeChange,max:e.size.maxHeight}].map((e,t)=>a.createElement(te.A,{direction:"row",spacing:2,style:{alignItems:"center"},key:t},a.createElement(G.A,{variant:"body1"},e.title),a.createElement(v.A,{sx:{width:100,display:"flex"}},a.createElement(ze.Ay,{size:"small",value:e.value,onChange:(t,n)=>{e.onChange(n)},slots:{valueLabel:_e},max:e.max,valueLabelDisplay:"auto"})))),a.createElement(x.A,{onClick:e=>{o(e.currentTarget)}},a.createElement(Se.A,null)),a.createElement(re.Ay,{open:r,anchorEl:n,onClose:()=>{o(null)},anchorOrigin:e.atBottom?{vertical:"top",horizontal:"left"}:{vertical:"bottom",horizontal:"left"},transformOrigin:e.atBottom?{vertical:"bottom",horizontal:"right"}:{vertical:"top",horizontal:"right"}},a.createElement(te.A,{spacing:2,sx:{p:2}},a.createElement(ne.A,{label:t("minWidth","Min Width"),type:"number",InputLabelProps:{},name:"minWidth",onChange:l,value:e.size.widthRange[0]||"",size:"small"}),a.createElement(ne.A,{label:t("maxWidth","Max Width"),type:"number",InputLabelProps:{},name:"maxWidth",onChange:l,value:e.size.widthRange[1]||e.size.maxWidth,size:"small"}),a.createElement(ne.A,{label:t("minHeight","Min Height"),type:"number",InputLabelProps:{},name:"minHeight",onChange:l,value:e.size.heightRange[0]||"",size:"small"}),a.createElement(ne.A,{label:t("maxHeight","Max Height"),type:"number",InputLabelProps:{},name:"maxHeight",onChange:l,value:e.size.heightRange[1]||e.size.maxHeight,size:"small"}))))};var Oe=n(51475),Pe=n(37603),Te=n(34821),De=n(88629);function Me(e){const{t}=(0,R.Bd)(["output"]),[n,o]=a.useState(null),l=Boolean(n),r=()=>{o(null)};return a.createElement("div",{style:{}},a.createElement(K.A,{sx:{width:"100%"},variant:"outlined",endIcon:n?a.createElement(Te.A,null):a.createElement(De.A,null),onClick:e=>{o(e.currentTarget)}},t(e.sortBy)),a.createElement(Oe.A,{sx:{width:"100%"},id:"basic-menu",anchorEl:n,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:l,onClose:r,MenuListProps:{"aria-labelledby":"basic-button"}},["default","bigFirst","smallFirst"].map(n=>a.createElement(Pe.A,{"data-click-ga":`sort-by-${n}`,key:n,selected:e.sortBy==n,onClick:()=>{r(),e.setSortBy(n)}},t(n)))))}const Le=e=>{const t=(0,a.useContext)(O.Q);return t.appconfig.noTextOnButton||t.win_width<1600?a.createElement(x.A,{"data-click-ga":e["data-click-ga"]||"",title:e.title,onClick:e.onClick,color:"primary"},e.startIcon):a.createElement(K.A,{"data-click-ga":e["data-click-ga"]||"",title:e.title,startIcon:e.startIcon,variant:e.variant,onClick:e.onClick},e.children)};var $e=n(20424),Be=n(17118),je=n(91799),We=n(43760),He=n(77803),Fe=n(87788),Ne=n(42162),Ve=n(76320),Ue=n(52764),Ke=n(79072),Ge=n(910),qe=n(23668),Ye=n(7527),Xe=n(85342),Ze=n(12070);const Qe=({appendRenameCode:e,handleRestoreRenameRule:t,renameRule:n})=>{const{t:o}=(0,R.Bd)(["output"]),l=(0,a.useMemo)(()=>[{code:"{NO}",label:o("no","Index")},{code:"{NO001}",label:o("no_padded","Padded Index (e.g., 001)")},{code:"{EXT}",label:o("ext","Extension")},{code:"{NAME}",label:o("original_filename","Original Filename")},{code:"{PTITLE}",label:o("ptitle","Page Title")},{code:"{DATE}",label:o("timestamp","Timestamp")},{code:"{GROUP}",label:o("group","Group")},{code:"{ITEM_ID}",label:o("item_id","Item ID")},{code:"{WIDTH}",label:o("width","Image Width")},{code:"{HEIGHT}",label:o("height","Image Height")},{code:"{DOMAIN}",label:o("domain","Domain")}],[o]),r=!n||""===n;return a.createElement(ie.A,{dense:!0,sx:{minWidth:400,maxWidth:600,p:1}},a.createElement(G.A,{variant:"subtitle2",sx:{px:2,py:1}},o("rename_rules_title","Click to insert variable")),a.createElement(ye.A,null),l.map((t,n)=>a.createElement(Ye.Ay,{dense:!0,key:t.code,disablePadding:!0},a.createElement(se.A,{onClick:n=>e(t.code,n),sx:{py:1,px:2,"&:hover":{bgcolor:"action.hover"}}},a.createElement(Xe.A,{container:!0,spacing:2,alignItems:"center",sx:{width:"100%"}},a.createElement(Xe.A,{size:4},a.createElement(G.A,{component:"code",sx:{fontFamily:"monospace",bgcolor:"action.selected",px:.75,py:.5,borderRadius:1,fontSize:"0.8rem",display:"inline-block",whiteSpace:"nowrap"}},t.code)),a.createElement(Xe.A,{size:8},a.createElement(G.A,{sx:{color:"text.secondary",fontSize:"0.875rem",lineHeight:1.4}},t.label)))))),a.createElement(ye.A,{sx:{my:.5}}),a.createElement(Ye.Ay,{dense:!0,disablePadding:!0},a.createElement(se.A,{onClick:t,disabled:r},a.createElement(Ze.A,null,a.createElement(qe.A,null)),a.createElement(ce.A,null,o("reset","Reset to Default")))))},Je=()=>{const{t:e}=(0,R.Bd)(["output"]),t=(0,a.useContext)(O.Q),n=(0,a.useRef)(null),o=(0,a.useRef)(null),l=(0,a.useRef)(!1),[r,i]=(0,a.useState)(null),[s,c]=(0,a.useState)([0,0]),[d,u]=(0,a.useState)(t.appconfig.rename.rule),m=Boolean(r),g=(0,a.useRef)(t.appconfig.rename.rule);g.current!==t.appconfig.rename.rule&&d===g.current&&(u(t.appconfig.rename.rule),g.current=t.appconfig.rename.rule);const h=(0,a.useCallback)(e=>{o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{const n={...t.appconfig,rename:{...t.appconfig.rename,rule:e}};t.setAppconfig(n),chrome.storage.local.set({[T.V2]:n}),g.current=e},200)},[t]),p=(0,a.useCallback)(e=>{o.current&&clearTimeout(o.current);const n={...t.appconfig,rename:{...t.appconfig.rename,rule:e}};t.setAppconfig(n),chrome.storage.local.set({[T.V2]:n}),g.current=e},[t]),f=(0,a.useCallback)(e=>{const t=e.target;c([t.selectionStart||0,t.selectionEnd||0])},[]),w=(0,a.useCallback)(e=>{const n={...t.appconfig,rename:{enabled:e.target.checked,rule:t.appconfig.rename.rule}};t.setAppconfig(n),chrome.storage.local.set({[T.V2]:n}),e.target.checked||i(null)},[t]),b=(0,a.useCallback)(e=>{i(t=>t?null:e.currentTarget.parentNode)},[]),E=(0,a.useCallback)(()=>{u(""),p("")},[p]),v=(0,a.useCallback)((e,t)=>{const[a,o]=s,l=d.substring(0,a)+e+d.substring(o);u(l),p(l);const r=a+e.length;c([r,r]),setTimeout(()=>{n.current&&(n.current.focus(),n.current.setSelectionRange(r,r))},0),null==t||t.stopPropagation()},[d,s,p]),A=(0,a.useCallback)(e=>{const t=e.target.value;u(t),l.current||h(t)},[h]),k=(0,a.useCallback)(()=>{l.current=!0},[]),y=(0,a.useCallback)(e=>{l.current=!1;const t=e.target.value;h(t)},[h]),C=(0,a.useCallback)(()=>{p(d)},[d,p]),I=(0,a.useCallback)(e=>{const t=e.target,a=t.selectionStart||0,o=t.selectionEnd||0;if("Delete"===e.key||"Backspace"===e.key){if(a===o){const t=/\{[A-Z_]+(?:\d+)?\}/g;let o,l=null;for(;null!==(o=t.exec(d));)if("Delete"===e.key){if(o.index===a){l=o;break}}else if(o.index+o[0].length===a){l=o;break}if(l){e.preventDefault();const t=d.substring(0,l.index)+d.substring(l.index+l[0].length);return u(t),h(t),void setTimeout(()=>{n.current&&n.current.setSelectionRange(l.index,l.index)},0)}}}else{if((e.ctrlKey||e.metaKey)&&("Delete"===e.key||"Backspace"===e.key)){e.preventDefault();const t=d.replace(/\{[A-Z_]+(?:\d+)?\}/g,"");return u(t),void h(t)}"Escape"===e.key&&m&&(e.preventDefault(),i(null))}},[d,m,h]),S=(0,a.useMemo)(()=>t.appconfig.rename.enabled?T.Yd:e("rename","Rename"),[t.appconfig.rename.enabled,e]);return a.createElement(a.Fragment,null,a.createElement(Be.A,{inputRef:n,sx:{pl:0,pr:0},onSelect:f,onBlur:C,onKeyDown:I,onCompositionStart:k,onCompositionEnd:y,placeholder:S,value:d,onChange:A,disabled:!t.appconfig.rename.enabled,inputProps:{"aria-label":e("rename_rule_input","Rename rule input"),spellCheck:!1,autoComplete:"off"},startAdornment:a.createElement(Ve.A,{onChange:w,checked:t.appconfig.rename.enabled,color:"primary"}),endAdornment:a.createElement(x.A,{onClick:b,disabled:!t.appconfig.rename.enabled},a.createElement(Ke.A,{color:m?"primary":"action"})),size:"small"}),a.createElement(Ge.A,{open:m,anchorEl:r,placement:"top-end",sx:{zIndex:6}},a.createElement($e.A,null,a.createElement(Qe,{appendRenameCode:v,handleRestoreRenameRule:E,renameRule:d}))))},et=({open:e,anchorEl:t,onClose:n,previewSize:o,handlePreviewSizeChange:l,keyword:r,handleKeywordChange:i})=>{var s;const{appconfig:c,setAppconfig:d}=(0,a.useContext)(O.Q),{t:u}=(0,R.Bd)();return a.createElement(re.Ay,{open:e,anchorEl:t,onClose:n,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{zIndex:5},slotProps:{paper:{sx:{overflow:"visible"}}}},a.createElement($e.A,{sx:{px:3,py:2,minWidth:400}},a.createElement(te.A,{spacing:2},a.createElement(te.A,{direction:"row",spacing:2,alignItems:"center"},a.createElement(G.A,{sx:{whiteSpace:"nowrap"}},u("output:previewSize","Preview Size")),a.createElement(ze.Ay,{marks:!0,step:10,size:"small",max:300,min:50,valueLabelDisplay:"auto",valueLabelFormat:e=>`${e}px`,value:o,onChange:l})),a.createElement(Je,null),a.createElement(Be.A,{value:r,onChange:i,startAdornment:a.createElement(Ue.A,null),size:"small",placeholder:u("output:filter_by_keyword","Filter by keyword")}),a.createElement(ye.A,null),a.createElement(je.A,null,a.createElement(We.A,null,u("output:downloaded_image_size","Downloaded image size")),a.createElement(He.A,{row:!0,value:c.downloadSize.type,onChange:(e,t)=>{chrome.storage.local.set({[T.V2]:{...c,downloadSize:{...c.downloadSize,type:t}}})}},a.createElement(Fe.A,{label:u("output:original_size","Original size"),value:"origin",control:a.createElement(Ne.A,null)}),a.createElement(Fe.A,{label:u("output:custom_size","Custom size"),value:"custom",control:a.createElement(Ne.A,null)})),"custom"===c.downloadSize.type&&a.createElement(ne.A,{size:"small",label:u("output:image_width","Image width"),value:c.downloadSize.width,onChange:e=>{chrome.storage.local.set({[T.V2]:{...c,downloadSize:{...c.downloadSize,width:parseInt(e.target.value)}}})}})),a.createElement(ye.A,null),a.createElement(Fe.A,{sx:{m:0,justifyContent:"space-between"},control:a.createElement(Ve.A,{"data-click-ga":"dark-mode",onChange:e=>{const t=e.target.checked?"dark":"light";d({colorMode:t})},checked:"dark"===c.colorMode,color:"primary"}),label:u("output:darkMode","Dark Mode"),labelPlacement:"start"}),a.createElement(ye.A,null),a.createElement(Fe.A,{sx:{m:0,justifyContent:"space-between"},control:a.createElement(Ve.A,{"data-click-ga":"zip",color:"primary",checked:c.zip.enabled,onChange:e=>{const t={...c,zip:{...c.zip,enabled:e.target.checked}};chrome.storage.local.set({[T.V2]:t})}}),label:u("output:zip_enabled","Download as ZIP"),labelPlacement:"start"}),c.zip.enabled&&a.createElement(je.A,{sx:{ml:2}},a.createElement(We.A,{sx:{fontSize:"0.875rem"}},u("output:zip_folder_structure","Folder structure")),a.createElement(He.A,{value:c.zip.folderStructure||"grouped",onChange:(e,t)=>{chrome.storage.local.set({[T.V2]:{...c,zip:{...c.zip,folderStructure:t}}})}},a.createElement(Fe.A,{value:"grouped",control:a.createElement(Ne.A,{size:"small"}),label:a.createElement(G.A,{variant:"body2"},u("output:zip_grouped","Group in folder (images in subfolder)"))}),a.createElement(Fe.A,{value:"flat",control:a.createElement(Ne.A,{size:"small"}),label:a.createElement(G.A,{variant:"body2"},u("output:zip_flat","Direct compression (images at root)"))})),"flat"===c.zip.folderStructure&&a.createElement(Fe.A,{sx:{mt:1,ml:2},control:a.createElement(Ve.A,{size:"small",checked:null!==(s=c.zip.flatWithPrefix)&&void 0!==s&&s,onChange:e=>{chrome.storage.local.set({[T.V2]:{...c,zip:{...c.zip,flatWithPrefix:e.target.checked}}})}}),label:a.createElement(G.A,{variant:"body2"},u("output:zip_flat_with_prefix","Add page title prefix to filename"))})))))};var tt=n(79239);const nt=e=>{const{appconfig:t,setAppconfig:n}=(0,a.useContext)(O.Q),{t:o}=(0,R.Bd)(),[l,r]=a.useState(null),i=Boolean(l);return a.createElement(v.A,null,a.createElement(te.A,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",useFlexGap:!0},a.createElement(Le,{"data-click-ga":"download",variant:"contained",onClick:e.downloadSelectImgs,startIcon:a.createElement(pe.A,null)},o("output:download","Download")+(t.dl_shortcut?` (Alt+${t.dl_shortcut.toUpperCase()})`:"")),a.createElement(Le,{"data-click-ga":"export-links",startIcon:a.createElement(fe.A,null),variant:"contained",onClick:()=>e.setLinkExportPanelOpen(!0)},o("output:export_links","Export Links")),a.createElement(Le,{"data-click-ga":"stitch-images",startIcon:a.createElement(we.A,null),variant:"contained",onClick:e.stitchImgs},o("output:stitch_tip","Stitch Images")),a.createElement(Le,{"data-click-ga":"image-cutout",startIcon:a.createElement(be.A,null),variant:"contained",onClick:e.cutoutImage},o("output:cutoutImage","Cutout")),a.createElement(ye.A,{orientation:"vertical",flexItem:!0}),a.createElement(Le,{"data-click-ga":"select-all",startIcon:a.createElement(Ee.A,null),variant:"contained",onClick:e.handleCheckAll},o("output:select_all","All")),a.createElement(Le,{"data-click-ga":"select-toggle",startIcon:a.createElement(ve.A,null),variant:"contained",onClick:e.handleCheckReverse},o("output:select_toggle","Toggle")),a.createElement(ye.A,{orientation:"vertical",flexItem:!0}),a.createElement(Re,{handleWidthRangeChange:e.handleWidthRangeChange,handleHeightRangeChange:e.handleHeightRangeChange,size:e.size}),a.createElement(Me,{sortBy:e.sortBy,setSortBy:e.setSortBy}),a.createElement(v.A,{sx:{flexGrow:1}}),a.createElement(te.A,{direction:"row",spacing:1,alignItems:"center"},a.createElement(x.A,{onClick:()=>window.open("help.html"),"data-click-ga":"help"},a.createElement(xe.A,null)),a.createElement(Ce.A,{title:o("output:five_star_review","Five-star review")},a.createElement(x.A,{"data-click-ga":"five-stars",onClick:()=>{let e=`https://chromewebstore.google.com/detail/${chrome.runtime.id}/reviews`;navigator.userAgent.match("Edg")&&(e=`https://microsoftedge.microsoft.com/addons/detail/${chrome.runtime.id}`),chrome.tabs.create({url:e})}},a.createElement(Ae.A,{sx:{color:tt.A[500]}}))),a.createElement(Ie.A,{target:"_blank",href:`${T.h4}/downloadZip`},o("output:downloadInstaller","Download Installer")),a.createElement(x.A,{"data-click-ga":"show-more",onClick:e=>{r(l?null:e.currentTarget)},color:i?"primary":"default"},a.createElement(ke.A,null)))),a.createElement(et,{open:i,anchorEl:l,onClose:()=>{r(null)},previewSize:e.previewSize,handlePreviewSizeChange:e.handleChange,keyword:e.keyword,handleKeywordChange:e.handleKeywordChange}))};var at=n(61140),ot=n(64951);function lt({tabs:e,currentPage:t,setCurrentPage:n,onClose:o}){return a.createElement(v.A,{sx:{bgcolor:"background.paper",borderBottom:1,borderColor:"divider"}},a.createElement(at.A,{value:t,onChange:(e,t)=>{n(t)},variant:"scrollable",scrollButtons:"auto","aria-label":"scrollable auto tabs example"},e.map((e,t)=>a.createElement(ot.A,{key:e.id,value:e.id,sx:{},label:a.createElement(v.A,{sx:{display:"flex",alignItems:"center"}},e.icon&&a.createElement(v.A,{sx:{width:"32px",height:"32px",mr:"4px",backgroundImage:`url(${e.icon})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:"4px"}}),a.createElement(G.A,{variant:"body2",sx:{width:"200px",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}},e.title),-1!=e.id&&a.createElement(x.A,{onClick:t=>{o(e.id),t.stopPropagation()},size:"small"},a.createElement(S.A,null)))}))))}var rt=n(71939);function it(){const e=(0,E.A)();return a.createElement(v.A,{component:"div",className:"test",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",background:e.palette.background.paper}},a.createElement(rt.A,{target:"_blank"}))}const st=a.createContext({imgs:[],imgOnload:()=>{},imgOnerror:()=>{}});var ct=n(87902),dt=n(17210);const ut=a.memo(({visibleImgs:e,totalCount:t,onShowAll:n})=>{const{t:o}=(0,R.Bd)(["output"]),l=t-e.length,r=e.filter(e=>e.isSelected).length,i=e.filter(e=>-1!==e.downloadId).length,s=[];return i>0&&s.push(`${o("downloaded","Downloaded")}: ${i}`),r>0&&s.push(`${o("selected","Selected")}: ${r}`),s.push(`${o("showed","Showed")} : ${e.length}`),s.push(`${o("hidden","Hidden")}: ${l}`),s.push(`${o("total","Total")}: ${t}`),a.createElement(v.A,{sx:{p:2,display:"flex",alignItems:"center"}},a.createElement(G.A,{variant:"h5"},s.join(" / ")),l>0&&a.createElement(K.A,{onClick:n,color:"warning",sx:{ml:2},variant:"contained"},o("showAll","Show All")))});var mt=n(27629);function gt({title:e,groupId:t,imgs:n,onChange:o,downloadImgs:l,exportImgs:r,stitchImgs:i,onWidthChange:s}){var c,d,u;const{t:m}=(0,R.Bd)(["output"]),g=n.filter(e=>e.isSelected),[h,p]=(0,a.useState)((null===(d=null===(c=n[0])||void 0===c?void 0:c.downloadWidth)||void 0===d?void 0:d.toString())||"");(0,a.useEffect)(()=>{var e,t;const a=(null===(t=null===(e=n[0])||void 0===e?void 0:e.downloadWidth)||void 0===t?void 0:t.toString())||"";a!==h&&p(a)},[null===(u=n[0])||void 0===u?void 0:u.downloadWidth]);return a.createElement(te.A,{direction:"row",spacing:2,sx:{alignItems:"center",justifyContent:"space-between"}},a.createElement(G.A,{sx:{width:"50%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},variant:"h6"},e),a.createElement(te.A,{direction:"row",spacing:1,sx:{alignItems:"center"}},a.createElement(ne.A,{label:m("download_width","Download Width"),size:"small",type:"number",value:h,onChange:e=>{const n=e.target.value;p(n);const a=n?parseInt(n,10):void 0;s(a);const o=`${T.f3}_${t}`;chrome.storage.local.get(o,e=>{const t=e[o]||{};t.width=a,chrome.storage.local.set({[o]:t})})},sx:{width:"120px"},InputProps:{endAdornment:h?a.createElement(ae.A,{position:"end"},a.createElement(x.A,{onClick:()=>{p(""),s(void 0);const e=`${T.f3}_${t}`;chrome.storage.local.get(e,t=>{const n=t[e]||{};n.width=void 0,chrome.storage.local.set({[e]:n})})},edge:"end",size:"small"},a.createElement(Z.A,{fontSize:"small"}))):null}}),a.createElement(mt.A,{"data-click-ga":"group-check",checked:n.length>0&&g.length===n.length,indeterminate:(0,D.inRange)(g.length,1,n.length),onChange:o}),a.createElement(Ce.A,{title:m("download_group","Download this group")},a.createElement(x.A,{"data-click-ga":"group-download",color:"primary",onClick:()=>l(n)},a.createElement(pe.A,null))),a.createElement(Ce.A,{title:m("export_group_imgs","Export group images")},a.createElement(x.A,{"data-click-ga":"group-export",color:"primary",onClick:()=>r(n)},a.createElement(fe.A,null))),a.createElement(Ce.A,{title:m("stitch_tip","Stitch selected images")},a.createElement("span",null,a.createElement(x.A,{"data-click-ga":"group-stitch",color:"primary",onClick:()=>i(g),disabled:0===g.length},a.createElement(we.A,null))))))}var ht=n(3797);const pt=({img:e,previewSize:t,onImgLoad:n,onImgError:o,onMouseDown:l,onAuxClick:r,onClick:i,onDoubleClick:s})=>a.createElement("div",{className:"img-item-inner",onMouseDown:l,onAuxClick:r,onClick:i,onDoubleClick:s,style:{height:t,width:t,padding:"8px",display:"flex",alignItems:"center",justifyContent:"center"}},"VIDEO"===e.type?a.createElement("video",{style:{maxHeight:"100%",maxWidth:"100%"},src:e.src,onLoadedMetadata:t=>{const a=t.currentTarget;e.width||n(e,a.videoWidth,a.videoHeight)},controls:!0}):a.createElement("img",{style:{maxHeight:"100%",maxWidth:"100%"},src:e.hdSrc,alt:"",onLoad:t=>{const a=t.currentTarget;e.width||n(e,a.naturalWidth,a.naturalHeight),!e.loaded&&e.thumbnail&&(a.src=e.thumbnail)},onError:t=>{t.currentTarget;o(e)},loading:"lazy"}));var ft=n(32044),wt=n(93424),bt=n(31694);const Et=({img:e,onDelete:t})=>{const{t:n}=(0,R.Bd)(),o=n=>{n.preventDefault(),n.stopPropagation(),t(e)};return a.createElement(a.Fragment,null,a.createElement(v.A,{sx:{position:"absolute",top:"5px",left:"5px",zIndex:1,display:e.isSelected?"block":"none"}},a.createElement(Ce.A,{title:n("output:unselect","Unselect")},a.createElement(bt.A,{sx:{bgcolor:"background.paper",borderRadius:"100%",cursor:"pointer",fontSize:"24px",transition:"transform 0.2s ease-in-out","&:hover":{transform:"scale(1.1)"}},color:"primary"}))),a.createElement(v.A,{sx:{position:"absolute",top:"5px",right:"5px",zIndex:1}},e.error?a.createElement(Ce.A,{title:e.error},a.createElement(ft.A,{sx:{background:"#fff",borderRadius:"50%",fontSize:"22px"},color:"error"})):"complete"===e.downloadState?a.createElement(Ce.A,{title:n("output:show_in_folder","Show in folder")},a.createElement(x.A,{className:"open-folder-btn",size:"small",color:"primary","data-click-ga":"show-in-folder",onClick:()=>chrome.downloads.show(e.downloadId),sx:{backgroundColor:"rgba(255, 255, 255, 0.9)","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)"}}},a.createElement(wt.A,{fontSize:"small"}))):a.createElement(Ce.A,{title:n("output:delete","Delete")},a.createElement(x.A,{"data-click-ga":"delete-img",className:"close-btn",size:"small",onClick:o,sx:{display:"none",backgroundColor:"rgba(255, 255, 255, 0.8)","&:hover":{backgroundColor:"rgba(255, 255, 255, 1)"}}},a.createElement(S.A,{fontSize:"small"})))))};var vt=n(17862);const xt=({width:e,height:t,customSize:n})=>{const{t:o}=(0,R.Bd)();return a.createElement(v.A,{className:"size",sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:1,p:1,backgroundColor:"action.hover"}},a.createElement(vt.A,{label:`${e} x ${t}`,size:"small"}),n&&a.createElement(Ce.A,{title:o("output:customSize","Custom size")},a.createElement(vt.A,{label:`${n.width} x ${n.height}`,size:"small",variant:"outlined",color:"secondary"})))};var At=n(48349),kt=n(65505),yt=n(79511);const Ct=({img:e,showDlTip:t,onDownload:n,onCloseTip:o,onSearchImage:l})=>{const{t:r}=(0,R.Bd)(),i=(e,t)=>{e.stopPropagation(),t()};return a.createElement(v.A,{className:"img-actions",sx:{display:"flex",justifyContent:"space-around",alignItems:"center",height:"40px",bgcolor:"rgba(0, 0, 0, 0.5)",opacity:1,"& .MuiIconButton-root":{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},"& a":{color:"white"}},onClick:e=>e.stopPropagation()},a.createElement(Ce.A,{title:t?a.createElement(v.A,{sx:{display:"flex",alignItems:"center",gap:1}},r("output:dl_single_tip","Right/middle/double click image to download without clicking button"),a.createElement(S.A,{sx:{fontSize:"16px",cursor:"pointer"},onClick:o})):r("output:Download","Download")},a.createElement(x.A,{size:"small","data-click-ga":"download-single",onClick:e=>i(e,n)},a.createElement(pe.A,{fontSize:"small"}))),"IMAGE"===e.type&&a.createElement("a",{className:"zoomout","data-img-id":e.id,href:e.hdSrc,"data-pswp-width":e.width,"data-pswp-height":e.height,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation()},a.createElement(Ce.A,{title:r("output:zoom","Zoom")},a.createElement(x.A,{size:"small","data-click-ga":"zoom-out",component:"span"},a.createElement(At.A,{fontSize:"small"})))),a.createElement(Ce.A,{title:r("output:open_in_new_tab","Open in new tab")},a.createElement(x.A,{size:"small","data-click-ga":"open-in-new",onClick:t=>i(t,()=>window.open(e.hdSrc))},a.createElement(kt.A,{fontSize:"small"}))),"IMAGE"===e.type&&a.createElement(Ce.A,{title:r("output:search","Search")},a.createElement(x.A,{size:"small","data-click-ga":"search-img",onClick:e=>i(e,l)},a.createElement(yt.A,{fontSize:"small"}))))},It="middle_click",St="ctrl_click",zt="double_click",_t="btn_click",Rt=e=>{const t=(0,E.A)(),n=(0,a.useContext)(O.Q),{imgOnload:o,imgOnerror:l}=(0,a.useContext)(st),[r,i]=(0,a.useState)(!localStorage.closeDlTip),s=(0,a.useCallback)(t=>{e.img.download(),(0,A.VM)([{name:"dl_single",params:{action:t,phostname:new URL(e.img.tab.url).hostname}}])},[e.img]),c=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),i(!1),localStorage.closeDlTip=!0},[]),d=(0,a.useCallback)(async()=>{n.appconfig.search_img_page_in_sidePanel?chrome.sidePanel.setOptions({path:`/searchImage.html?imgSrc=${e.img.hdSrc}`},()=>{chrome.windows.getCurrent(e=>{e.id&&chrome.sidePanel.open({windowId:e.id})})}):window.open(`/searchImage.html?imgSrc=${e.img.hdSrc}`,"_blank")},[n.appconfig.search_img_page_in_sidePanel,e.img.hdSrc]),u="custom"===n.appconfig.downloadSize.type?{width:n.appconfig.downloadSize.width,height:Math.floor(n.appconfig.downloadSize.width/e.img.width*e.img.height)}:null,m=(0,a.useCallback)(e=>{1===e.button&&n.appconfig.dlSingleMethods.middleClick&&(e.stopPropagation(),e.preventDefault())},[n.appconfig.dlSingleMethods.middleClick]),g=(0,a.useCallback)(e=>{1===e.button&&n.appconfig.dlSingleMethods.middleClick&&(s(It),e.stopPropagation())},[n.appconfig.dlSingleMethods.middleClick,s]),h=(0,a.useCallback)(e=>{e.ctrlKey&&n.appconfig.dlSingleMethods.ctrlClick&&(s(St),e.stopPropagation())},[n.appconfig.dlSingleMethods.ctrlClick,s,e.img]),p=(0,a.useCallback)(e=>{n.appconfig.dlSingleMethods.doubleClick&&(s(zt),e.stopPropagation())},[n.appconfig.dlSingleMethods.doubleClick,s]);return a.createElement(v.A,{className:"img-item",sx:{position:"relative",m:.5,borderRadius:2,overflow:"hidden",border:"2px solid",borderColor:e.img.isSelected?t.palette.primary.main:ht.A[200],boxShadow:t.shadows[1],transition:`all ${t.transitions.duration.short}ms ${t.transitions.easing.easeInOut}`,"&:hover":{boxShadow:t.shadows[4],borderColor:t.palette.primary.light,"& .close-btn":{display:"inline-flex"}}}},a.createElement(Et,{img:e.img,onDelete:e.onDelete}),a.createElement(v.A,{sx:{position:"relative",cursor:"pointer"},onMouseDown:m,onAuxClick:g,onClick:h,onDoubleClick:p},a.createElement(pt,{img:e.img,previewSize:e.previewSize,onImgLoad:o,onImgError:l})),e.previewSize>=100&&a.createElement(a.Fragment,null,a.createElement(Ct,{img:e.img,showDlTip:r,onDownload:()=>s(_t),onCloseTip:c,onSearchImage:d}),a.createElement(xt,{width:e.img.width,height:e.img.height,customSize:u})))},Ot=a.memo(({groupedVisibleImgs:e,sortBy:t,setImgs:n,downloadImgs:o,deleteImage:l,previewSize:r,theme:i,exportImgs:s,stitchImgs:c})=>{const{t:d}=(0,R.Bd)(["output"]);(0,a.useEffect)(()=>{const t=Object.keys(e).map(e=>`${T.f3}_${e}`);chrome.storage.local.get(t,e=>{n(t=>{let n=!1;const a=t.map(t=>{const a=new URL(t.tab.url).host+t.group||chrome.i18n.getMessage("other"),o=`${T.f3}_${a}`;return e[o]&&e[o].width&&t.downloadWidth!==e[o].width&&(t.downloadWidth=e[o].width,n=!0),t});return n?[...a]:t})})},[Object.keys(e).join(","),n]);const u=(0,a.useCallback)(e=>{n(t=>t.map(t=>(t.id===e&&(t.isSelected=!t.isSelected),t)))},[n]),m=(0,a.useCallback)((e,t)=>{e.target.closest("button")||u(t.id)},[u]),g=(0,a.useCallback)((e,t)=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),u(t.id))},[u]),h=(0,a.useCallback)((e,t)=>{const a=e.target.checked,o=new Set(t.map(e=>e.id));n(e=>e.map(e=>(o.has(e.id)&&(e.isSelected=a),e)))},[n]),p=(0,a.useCallback)(e=>{l(e)},[l]),f=(0,a.useCallback)((e,t)=>{n(n=>[...n.map(n=>((new URL(n.tab.url).host+n.group||chrome.i18n.getMessage("other"))===e&&(n.downloadWidth=t),n))])},[n]),w=(0,a.useMemo)(()=>Object.entries(e).map(([e,n])=>{if(0===n.length)return{groupId:e,imageGroup:[]};return{groupId:e,imageGroup:[...n].sort((e,n)=>"smallFirst"===t?(e.width||0)*(e.height||0)-(n.width||0)*(n.height||0):"bigFirst"===t?(n.width||0)*(n.height||0)-(e.width||0)*(e.height||0):0)}}),[e,t]);return a.createElement(v.A,null,w.map(({groupId:t,imageGroup:n})=>n.length>0?a.createElement(v.A,{key:t},Object.keys(e).length>1&&a.createElement(v.A,{sx:{p:1}},a.createElement(gt,{title:n[0].group||d("other","Other"),groupId:t,imgs:n,onChange:e=>h(e,n),downloadImgs:o,exportImgs:s,stitchImgs:c,onWidthChange:e=>f(t,e)})),a.createElement(v.A,{sx:{display:"flex",flexWrap:"wrap"}},n.map(e=>a.createElement(v.A,{key:e.id,onClick:t=>m(t,e),onKeyDown:t=>g(t,e),className:"img-item-outter","data-id":e.id,role:"button",tabIndex:0,sx:{cursor:"pointer","&:focus-visible":{outline:`2px solid ${i.palette.primary.main}`,outlineOffset:"2px"}}},a.createElement(Rt,{img:e,previewSize:r,onDelete:()=>p(e)}))))):null))}),Pt=a.memo(({currentPageImgs:e,visibleImgs:t,groupedVisibleImgs:n,pageTabs:o,currentPage:l,imgs:r,showAll:i,sortBy:s,setImgs:c,downloadImgs:d,deleteImage:u,previewSize:m,theme:g,exportImgs:h,stitchImgs:p})=>{const{t:f}=(0,R.Bd)(["output"]),w=(0,a.useMemo)(()=>{var e;return-1===l?1===o.length?o[0].title:f("all_images","All Images"):null===(e=r.find(e=>e.tab.id===l))||void 0===e?void 0:e.tab.title},[l,o,r,f]);return e&&0!==e.length?a.createElement($e.A,{elevation:0,sx:{flex:1}},a.createElement(v.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"}},a.createElement(G.A,{variant:"h5",component:"h1",sx:{p:3,maxWidth:"32em",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},w),a.createElement(ut,{visibleImgs:t,totalCount:e.length,onShowAll:i})),a.createElement(Ot,{groupedVisibleImgs:n,sortBy:s,setImgs:c,downloadImgs:d,deleteImage:u,previewSize:m,theme:g,exportImgs:h,stitchImgs:p})):null}),Tt=()=>{const{t:e}=(0,R.Bd)(["output"]),t=(0,a.useContext)(O.Q),o=(0,E.A)(),{previewSize:l,setPreviewSize:r,currentPage:i,setCurrentPage:s,keyword:c,linkExportPanelOpen:d,setLinkExportPanelOpen:u,showBackdrop:m,setShowBackdrop:g,sortBy:h,setSortBy:p,handleChange:f,handleKeywordChange:w}=(()=>{const[e,t]=(0,a.useState)(P.D.previewSize),[n,o]=(0,a.useState)(-1),[l,r]=(0,a.useState)(""),[i,s]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)("default"),g=(0,a.useRef)(n);(0,a.useEffect)(()=>{g.current=n},[n]);const h=(0,a.useCallback)((e,n)=>{if("number"==typeof n){t(n);const e={...P.D,previewSize:n};chrome.storage.local.set({[T.V2]:e})}},[]),p=(0,a.useCallback)(e=>{r(e.target.value)},[]);return{previewSize:e,setPreviewSize:t,currentPage:n,setCurrentPage:o,keyword:l,setKeyword:r,linkExportPanelOpen:i,setLinkExportPanelOpen:s,showBackdrop:c,setShowBackdrop:d,sortBy:u,setSortBy:m,currentPageRef:g,handleChange:h,handleKeywordChange:p}})(),[b,A]=(0,a.useState)(),[k,y]=(0,a.useState)([]),[C,I]=(0,a.useState)(),M=(0,a.useRef)(null),L=(0,a.useRef)(null),{imgs:B,setImgs:W,addImgs:V,imgOnload:K,imgOnerror:G,handleCheckAll:X,handleCheckReverse:Z,deleteImage:Q,handleWidthRangeChange:J,handleHeightRangeChange:ee,showAll:te,size:ne,setSize:ae,deleteImagesByTab:oe}=(()=>{const[e,t]=(0,a.useState)([]),[n,o]=(0,a.useState)({widthRange:[0,0],heightRange:[0,0],maxWidth:0,maxHeight:0}),[l,r]=(0,a.useState)(null);(0,a.useEffect)(()=>{chrome.storage.local.get([T.V2],e=>{if(e[T.V2]){const t=e[T.V2];o(e=>{var n,a;return{...e,widthRange:(null===(n=t.output)||void 0===n?void 0:n.widthRange)||e.widthRange,heightRange:(null===(a=t.output)||void 0===a?void 0:a.heightRange)||e.heightRange}})}}),window===window.top&&chrome.windows.getCurrent({populate:!1},e=>{(null==e?void 0:e.id)&&(r(e.id),chrome.storage.session.get(`lastImages_${e.id}`,n=>{if(n[`lastImages_${e.id}`]){const a=n[`lastImages_${e.id}`].images.map(e=>new F(e.img,e.tab));t(a)}}))})},[]),(0,a.useEffect)(()=>{null!==l&&(0!==e.length?chrome.tabs.getCurrent(t=>{const n={tabId:(null==t?void 0:t.id)||-1,images:e.map(e=>({img:e.toObject(),tab:e.tab}))};chrome.storage.session.set({[`lastImages_${l}`]:n})}):chrome.storage.session.remove(`lastImages_${l}`))},[e,l]);const i=(0,a.useCallback)(async a=>{const l=Math.max(n.maxWidth,...a.map(e=>e.img.width||0)),r=Math.max(n.maxHeight,...a.map(e=>e.img.height||0));(l>n.maxWidth||r>n.maxHeight)&&o(e=>({...e,maxWidth:l,maxHeight:r,widthRange:e.widthRange[1]===e.maxWidth?[e.widthRange[0],l]:e.widthRange,heightRange:e.heightRange[1]===e.maxHeight?[e.heightRange[0],r]:e.heightRange}));const i=await Promise.all(a.map(async(t,n)=>new F({...t.img,hdSrc:t.img.hdSrc||await(0,N.A)(t.img.src),indexInPage:t.img.indexInPage?t.img.indexInPage:e.length+n},t.tab)));t(e=>(0,D.uniqWith)([...e,...i],(e,t)=>e.group===t.group&&e.hdSrc===t.hdSrc&&e.thumbnail===t.thumbnail))},[e.length,n.maxWidth,n.maxHeight]),s=(0,a.useCallback)(e=>{t(t=>t.map(t=>{if(t.id===e.id){const e=new F(t.toObject(),t.tab);return Object.assign(e,t),e.error="error",e}return t}))},[]),c=(0,a.useCallback)((e,n,a)=>{t(t=>t.map(t=>{if(t.id===e.id){const e=new F(t.toObject(),t.tab);return Object.assign(e,t),e.loaded=!0,e.setSize(n,a),e}return t})),o(e=>{const t=Math.max(e.maxWidth,n),o=Math.max(e.maxHeight,a);return t>e.maxWidth||o>e.maxHeight?{...e,maxWidth:t,maxHeight:o,widthRange:e.widthRange[1]===e.maxWidth?[e.widthRange[0],t]:e.widthRange,heightRange:e.heightRange[1]===e.maxHeight?[e.heightRange[0],o]:e.heightRange}:e})},[]),d=(0,a.useCallback)(()=>{t(e=>e.map(e=>{if(e.isSelected)return e;const t=new F(e.toObject(),e.tab);return Object.assign(t,e),t.isSelected=!0,t}))},[]),u=(0,a.useCallback)(()=>{t(e=>e.map(e=>{const t=new F(e.toObject(),e.tab);return Object.assign(t,e),t.isSelected=!e.isSelected,t}))},[]),m=(0,a.useCallback)(e=>{Array.isArray(e)&&o(t=>{const n={...t,widthRange:e};return chrome.storage.local.get([T.V2],e=>{const t=e[T.V2]||P.D;t.output={widthRange:n.widthRange,heightRange:n.heightRange},chrome.storage.local.set({[T.V2]:t})}),n})},[]),g=(0,a.useCallback)(e=>{Array.isArray(e)&&o(t=>{const n={...t,heightRange:e};return chrome.storage.local.get([T.V2],e=>{const t=e[T.V2]||P.D;t.output={widthRange:n.widthRange,heightRange:n.heightRange},chrome.storage.local.set({[T.V2]:t})}),n})},[]),h=(0,a.useCallback)(()=>{chrome.storage.local.get([T.V2],e=>{const t=e[T.V2]||P.D;t.output={},chrome.storage.local.set({[T.V2]:t},()=>{o(e=>({...e,widthRange:[0,e.maxWidth],heightRange:[0,e.maxHeight]}))})})},[]),p=(0,a.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e.id))},[]),f=(0,a.useCallback)(e=>{t(t=>t.filter(t=>t.tab.id!==e))},[]),w=(0,a.useCallback)(()=>(0,D.groupBy)(e,e=>e.tab.id),[e]);return{imgs:e,setImgs:t,size:n,setSize:o,addImgs:i,imgOnload:c,imgOnerror:s,handleCheckAll:d,handleCheckReverse:u,deleteImage:p,deleteImagesByTab:f,getPagedImgs:w,handleWidthRangeChange:m,handleHeightRangeChange:g,showAll:h}})(),le=(0,a.useRef)(B);(0,a.useEffect)(()=>{le.current=B},[B]);const{downloadImgs:re,translateImage:ie,cutoutImage:se}=((e,t,n)=>{const o=(0,a.useRef)(new AbortController),l=o.current.signal,[r,i]=(0,a.useState)([]);return(0,a.useEffect)(()=>{r.length>0&&t(a.createElement(q,{imgs:r,instantDownload:()=>{o.current.abort()},downloadId:-1}))},[r,t]),(0,a.useEffect)(()=>()=>{o.current.abort()},[]),{downloadImgs:(0,a.useCallback)(o=>{chrome.storage.local.get(T.V2,r=>{const s=r[T.V2];if(s.zip.enabled)e(!0),o.forEach(e=>{e.fetchStatus=void 0}),i([...o]),Promise.all(o.map(async(e,t)=>{if(!e.downloadWidth)return e.zipDownload(s,{index:t},l,()=>{i(e=>[...e]),n(e=>[...e])});try{const a=await(0,j.F_)(e.hdSrc,e.downloadWidth),o=await fetch(a),l=await o.arrayBuffer();return e.fetchStatus=H.OK,i(e=>[...e]),n(e=>[...e]),{file:l,filename:e.getFilename(s,t),status:H.OK,url:e.hdSrc}}catch(t){return e.fetchStatus=H.FAILED,i(e=>[...e]),n(e=>[...e]),{status:H.FAILED,url:e.hdSrc}}})).then(e=>{const n=o[0],l=new(U()),r="grouped"===s.zip.folderStructure,c={};e.forEach((e,t)=>{var n;if(e.status===H.OK){let a=null===(n=e.filename)||void 0===n?void 0:n.match("(.+)\\.([a-zA-Z]+)$"),i=e.filename||"",d="";a&&(i=a[1],d=a[2]);const u=i.split("/").pop()||i,m=`${o[t].tab.id}_${u}`;c[m]?c[m]++:c[m]=1;let g=`${c[m]>1?u+"-"+(0,Y.RN)(c[m]-1,3):u}.${d}`;r?g=e.filename||g:s.zip.flatWithPrefix&&(g=`${$(o[t].docTitle||o[t].tab.title)}_${g}`),l.file(g,e.file)}});const d=n.docTitle||n.tab.title;if(s.record_page_info){const t=r?`${$(d)}/pageInfo.txt`:`${d}.txt`;l.file(t,[n.tab.url,`total: ${o.length}`,`successed: ${e.filter(e=>e.status===H.OK).length}`,`failed: ${e.filter(e=>e.status===H.FAILED).length}`].join("\r\n"))}const u=$(d);l.generateAsync({type:"blob"}).then(e=>{chrome.downloads.download({url:URL.createObjectURL(e),filename:`${u}.zip`},e=>{t(a.createElement(q,{imgs:o,downloadId:e})),i([])})})});else{const e=[];o.forEach((t,n)=>{if(s.record_page_info&&!e.find(e=>e.id===t.tab.id)){e.push(t.tab);const n=t.getFilename(s).split("/");n[n.length-1]="pageInfo.txt";const a=new Blob([t.tab.url],{type:"text/plain"}),o=URL.createObjectURL(a);chrome.downloads.download({url:o,filename:n.join("/")})}t.download({index:n})})}})},[l,e,t,n,i]),translateImage:(0,a.useCallback)(async t=>{e(!0);const n=[];for(const e of t){const t=await e.getBase64();n.push(t)}chrome.storage.local.set({translateImage:n},()=>{e(!1),chrome.tabs.create({url:`${T.oE}${T.Pc}`})})},[e]),cutoutImage:(0,a.useCallback)(async t=>{e(!0);const n=[];for(const e of t){const t=await e.getBase64();n.push({filename:e.alt,base64:t})}chrome.storage.local.set({cutoutImages:n},()=>{e(!1),chrome.tabs.create({url:`${T.h4}/image-cutout`})})},[e]),signal:l}})(g,A,W),ce=(0,a.useRef)(re);(0,a.useEffect)(()=>{ce.current=re},[re]),((e,t,n)=>{(0,a.useEffect)(()=>{if(window===window.top){const t=t=>{"update_imgs"===t.type&&e(t.imgs)};return chrome.runtime.onMessage.addListener(t),chrome.runtime.sendMessage({type:"PAGE_READY"}),()=>{chrome.runtime.onMessage.removeListener(t)}}{const t=t=>{"update_imgs_from_ct"===t.data.type&&chrome.tabs.query({active:!0,currentWindow:!0},n=>{n.length>0&&n[0].id&&e(t.data.imgs.map(e=>({img:e,tab:n[0]})))})};return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}},[e]),(0,a.useEffect)(()=>{const t=(t,n,a)=>{if("add_imgs"===t.cmd){const a=t.data.imgs.map(e=>({img:e,tab:n.tab}));e(a)}};return chrome.runtime.onMessage.addListener(t),()=>{chrome.runtime.onMessage.removeListener(t)}},[e]),(0,a.useEffect)(()=>{let e="";function a(a){t(t=>{var o,l;!e&&a.filename&&(e=(null===(o=a.filename.current)||void 0===o?void 0:o.substring(0,a.filename.current.indexOf(t[0].getFilename(n.appconfig).split("/")[0])))||"",chrome.storage.local.set({defaultDownloadLocation:e}));const r=t.find(e=>e.downloadId===a.id);return r&&(r.downloadState=null===(l=a.state)||void 0===l?void 0:l.current),[...t]})}chrome.downloads.onChanged.addListener(a);let o=-1;const l=e=>{e.tabId===o&&t(t=>{var n,a;const o=t.find(t=>t.hdSrc===e.url||t.requestId===e.requestId);return o&&(o.requestId=e.requestId),null==o||o.setContentType((null===(a=null===(n=e.responseHeaders)||void 0===n?void 0:n.find(e=>"content-type"===e.name.toLocaleLowerCase()))||void 0===a?void 0:a.value)||"image/unknown"),[...t]})};return chrome.tabs.getCurrent(e=>{o=(null==e?void 0:e.id)||-1,chrome.webRequest&&chrome.webRequest.onHeadersReceived.addListener(l,{tabId:o,urls:["<all_urls>"],types:["image","media"]},["responseHeaders"])}),()=>{chrome.downloads.onChanged.removeListener(a),chrome.webRequest&&chrome.webRequest.onHeadersReceived.removeListener(l)}},[n.appconfig,t]),(0,a.useEffect)(()=>{if(n.appconfig.dl_shortcut){const e=e=>{e.key===n.appconfig.dl_shortcut&&e.altKey&&window.dispatchEvent(new CustomEvent("downloadShortcut"))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}},[n.appconfig.dl_shortcut]),(0,a.useEffect)(()=>{chrome.storage.local.get([T.V2],e=>{e[T.V2]&&window.dispatchEvent(new CustomEvent("configLoaded",{detail:e[T.V2]})),window.addEventListener("focus",()=>{document.title=chrome.i18n.getMessage("outputPageTitle")})})},[])})(V,W,t);const{currentPageImgs:de,visibleImgs:ue,groupedVisibleImgs:ge,pageTabs:he,getSelectedImgs:pe}=((e,t,n,o,l)=>{const r=(0,a.useCallback)(()=>(0,D.groupBy)(e,e=>e.tab.id),[e]),i=(0,a.useCallback)(()=>{const e=r();return-1===t?Object.values(e).flat():e[t]},[t,r]),s=(0,a.useMemo)(()=>{const n=(0,D.groupBy)(e,e=>e.tab.id);return-1===t?Object.values(n).flat():n[t]||[]},[e,t]),c=(0,a.useMemo)(()=>s.filter(e=>{const t=!e.loaded&&!e.error||0===n.widthRange[1]||e.width>=n.widthRange[0]&&e.width<=n.widthRange[1]&&e.height>=n.heightRange[0]&&e.height<=n.heightRange[1],a=!o||e.hdSrc.match(new RegExp(o,"i"));return t&&a}),[s,n,o]),d=(0,a.useMemo)(()=>{const e=[...c];return e.sort((e,t)=>{if("default"===l)return 0;const n=(e.width||0)*(e.height||0),a=(t.width||0)*(t.height||0);return"smallFirst"===l?n-a:"bigFirst"===l?a-n:0}).sort((e,t)=>e.groupIndex-t.groupIndex),e},[c,l]),u=(0,a.useMemo)(()=>{const e=r();return Object.values(e).map(e=>e[0].tab)},[r]),m=(0,a.useMemo)(()=>(0,D.groupBy)(d,e=>new URL(e.tab.url).host+e.group||chrome.i18n.getMessage("other")),[d]),g=(0,a.useCallback)(()=>{const e=c.filter(e=>e.isSelected);return 0===e.length?c:e},[c]);return{currentPageImgs:s,visibleImgs:c,sortedVisibleImgs:d,pageTabs:u,groupedVisibleImgs:m,getSelectedImgs:g,getPagedImgs:r,getCurrentPageImgs:i}})(B,i,ne,c,h),fe=(0,a.useCallback)(e=>{oe(e),i===e&&s(-1)},[i,oe,s]);(0,a.useEffect)(()=>{let e=new z.A({gallery:"#main-content-wrapper",children:".img-item .zoomout",pswpModule:()=>n.e(8300).then(n.bind(n,48300))});return e.on("uiRegister",()=>{e.pswp.ui.registerElement({name:"download-button",order:9,is:"button",className:"pswp__button pswp__button--download",html:'<svg aria-hidden="true" class="pswp__icn" viewBox="0 0 24 24" width="24" height="24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>',onClick:t=>{var n,a,o,l,r;const i=null===(n=e.pswp)||void 0===n?void 0:n.currSlide,s=null===(r=null===(l=null===(o=null===(a=null==i?void 0:i.content)||void 0===a?void 0:a.data)||void 0===o?void 0:o.element)||void 0===l?void 0:l.dataset)||void 0===r?void 0:r.imgId;if(s){const e=le.current.find(e=>e.id===s);e&&ce.current([e])}}})}),e.init(),()=>e.destroy()},[]),(0,a.useEffect)(()=>{chrome.storage.local.get([T.V2],e=>{if(e[T.V2]){const t=e[T.V2];ae(e=>{var n,a;return{...e,widthRange:(null===(n=t.output)||void 0===n?void 0:n.widthRange)||e.widthRange,heightRange:(null===(a=t.output)||void 0===a?void 0:a.heightRange)||e.heightRange}}),r(t.previewSize||P.D.previewSize)}})},[ae,r]);const we=(0,a.useCallback)(e=>{0!==e.length&&chrome.storage.local.set({[T.b6]:e.map(e=>({src:e.hdSrc||e.src}))},()=>{chrome.tabs.create({url:"stitch.html"})})},[]),be=(0,a.useCallback)(()=>re(pe()),[re,pe]),Ee=(0,a.useCallback)(()=>ie(pe()),[ie,pe]),ve=(0,a.useCallback)(()=>se(pe()),[se,pe]),xe=(0,a.useCallback)(()=>we(pe()),[we,pe]),Ae=(0,a.useCallback)(()=>{y(pe()),I(e("export_links","Export Links")),u(!0)},[pe,u,e]),ke=(0,a.useCallback)(t=>{var n;y(t),I(e("export_links","Export Links")+" - "+(null===(n=t[0])||void 0===n?void 0:n.group)),u(!0)},[u,e]);(0,a.useEffect)(()=>(window.addEventListener("downloadShortcut",be),()=>window.removeEventListener("downloadShortcut",be)),[be]),(0,a.useEffect)(()=>{if(!M.current)return;const e=ue.filter(e=>e.isSelected&&(-1===i||e.tab.id===i)).map(e=>document.querySelector(`.img-item-outter[data-id="${e.id}"]`)).filter(Boolean);M.current.setSelectedTargets(e)},[B,ue,i]);const Ce=(0,a.useCallback)(e=>{if(e.inputEvent.ctrlKey||e.inputEvent.target.closest("button"))return;const t=new Set(e.added.map(e=>e.dataset.id)),n=new Set(e.removed.map(e=>e.dataset.id));0===t.size&&0===n.size||W(e=>e.map(e=>(t.has(e.id)&&(e.isSelected=!0),n.has(e.id)&&(e.isSelected=!1),e)))},[W]);return a.createElement(st.Provider,{value:{imgs:B,imgOnload:K,imgOnerror:G}},a.createElement(v.A,{sx:{display:"flex",height:"100%"}},a.createElement(v.A,{id:"main-content-wrapper",sx:{width:"100%",height:"100%",overflow:"auto",bgcolor:"dark"===o.palette.mode?"black":"white"}},a.createElement($e.A,{elevation:1,sx:{position:"sticky",top:0,zIndex:3,p:"4px",display:"flex",flexDirection:"column",gap:"4px"}},a.createElement(a.Fragment,null,a.createElement(it,null),a.createElement(ye.A,null)),a.createElement(nt,{sortBy:h,setSortBy:p,handleCheckAll:X,handleCheckReverse:Z,handleChange:f,handleKeywordChange:w,keyword:c,previewSize:l,size:ne,handleWidthRangeChange:J,handleHeightRangeChange:ee,translateImage:Ee,cutoutImage:ve,stitchImgs:xe,downloadSelectImgs:be,setLinkExportPanelOpen:Ae})),t&&a.createElement(v.A,null,he.length>1&&a.createElement(lt,{tabs:[{id:-1,title:e("all_images","All Images"),url:""},...he],currentPage:i,setCurrentPage:s,onClose:fe}),a.createElement(v.A,{ref:L,id:"main-content",sx:{flexGrow:1,overflow:"auto",display:"flex",gap:1}},a.createElement(Pt,{currentPageImgs:de,visibleImgs:ue,groupedVisibleImgs:ge,pageTabs:he,currentPage:i,imgs:B,showAll:te,sortBy:h,setImgs:W,downloadImgs:re,deleteImage:Q,previewSize:l,theme:o,exportImgs:ke,stitchImgs:we})),a.createElement(ct.A,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:m},a.createElement(x.A,{sx:{position:"absolute",top:"16px",right:"16px"},onClick:()=>g(!1)},a.createElement(S.A,{sx:{color:"#fff",fontSize:"48px"}})),b||a.createElement(dt.A,{color:"inherit"})),a.createElement(me,{open:d,imgs:k,title:C,onClose:()=>{u(!1),y([]),I(void 0)}}),a.createElement(_.Ay,{ref:M,selectableTargets:[".img-item-outter"],dragContainer:"#main-content",hitRate:40,selectFromInside:!0,selectByClick:!1,continueSelect:!0,toggleContinueSelect:null,scrollOptions:{container:L.current||document.body,throttleTime:30,threshold:0},dragCondition:e=>!e.inputEvent.target.closest("img, button"),onScroll:e=>{var t;return null===(t=L.current)||void 0===t?void 0:t.scrollBy(10*e.direction[0],10*e.direction[1])},onSelect:Ce})))))};n(62117);var Dt=n(38474),Mt=n(91207);const Lt=b.n;(0,y.H)(window.document.querySelector("#app-container")).render(a.createElement(function(){const[e,t]=(0,a.useState)(""),[n,o]=(0,a.useState)(null),[l,r]=(0,a.useState)([]),{palette:i}=(0,E.A)();(0,a.useEffect)(()=>{chrome.storage.local.get("ads",e=>{e.ads&&e.ads.length>0&&r(e.ads)})},[]);const[s,c]=(0,a.useState)(),[d,u]=a.useState(!1),m=l.find(e=>"bottom"==e.position);return a.useEffect(()=>{chrome.storage.local.get(["closeOutputAdCount_tz"],e=>{e.closeOutputAdCount_tz&&e.closeOutputAdCount_tz>=3?u(!1):chrome.storage.session.get("closeOutputAd",e=>{e.closeOutputAd||u(!0)})})},[]),(0,a.useEffect)(()=>{chrome.storage.session.get("adData",async e=>{let t=e.adData;t||(t=await fetch("https://fatkun.oss-cn-hongkong.aliyuncs.com/ads/data-v2.json?_"+(new Date).getDate()).then(e=>e.json()),chrome.storage.session.set({adData:t})),c(t.output.image)})},[]),a.createElement(Dt.A,null,a.createElement(Mt.c,null,a.createElement(Lt,{maxSnack:3},a.createElement(k.Provider,{value:{access_token:e,setAccess_token:t,userInfo:n,setUserInfo:o}},a.createElement(v.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",gap:1}},a.createElement(v.A,{sx:{flex:1,overflow:"auto"}},a.createElement(Tt,null)),m&&a.createElement("iframe",{src:m.url,style:{border:0,height:`${m.size}px`,overflow:"hidden",width:"100%"}})))),s&&s.images.length>0&&d&&a.createElement(v.A,{sx:{position:"fixed",right:"10px",bottom:"10px",zIndex:1e3,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.6)"}},a.createElement(x.A,{onClick:()=>{chrome.storage.local.get("closeOutputAdCount_tz",e=>{chrome.storage.local.set({closeOutputAdCount_tz:(e.closeOutputAdCount_tz||0)+1})}),chrome.storage.session.set({closeOutputAd:!0}),u(!1)},sx:{zIndex:111,position:"absolute",top:"5px",right:"5px",bgcolor:i.background.paper,"&:hover":{bgcolor:i.background.paper,color:i.text.primary},color:i.text.secondary}},a.createElement(S.A,null)))))},null)),(0,A.IG)(),window.addEventListener("load",async()=>{(0,A.VM)([{name:"page_view",params:{page_title:document.title,page_location:document.location.href}}])})},35343:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(31601),o=n.n(a),l=n(76314),r=n.n(l)()(o());r.push([e.id,"body {\n    margin: 0;\n    height: 100vh;\n}\n\n.container {\n}\n",""]);const i=r},38164:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(31601),o=n.n(a),l=n(76314),r=n.n(l)()(o());r.push([e.id,"::-webkit-scrollbar {\n    height: 6px;\n    width: 6px;\n}\n\n::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n    background: #dfdfdf;\n    border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n    background: #d4d4d4;\n}\n",""]);const i=r},47262:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(31601),o=n.n(a),l=n(76314),r=n.n(l)()(o());r.push([e.id,"#app-container {\n    height: 100%;\n    user-select: none;\n}\n",""]);const i=r},86185:(e,t,n)=>{n.d(t,{AN:()=>l,F_:()=>r,Yb:()=>s,gY:()=>o,p2:()=>i});var a=n(96921);function o(e,t){var n,o;e||(e=a.Yd);const l={ptitle:String(t.ptitle||""),itemId:String(t.itemId||t.ptitle||""),date:String(t.date||""),name:String(t.name||""),ext:String(t.ext||""),link:String(t.link||""),index:Number(null!==(n=t.index)&&void 0!==n?n:0),group:String(t.group||""),groupIndex:Number(null!==(o=t.groupIndex)&&void 0!==o?o:0),width:String(t.width||""),height:String(t.height||""),domain:String(t.domain||"")},r={PTITLE:l.ptitle,ITEM_ID:l.itemId,DATE:l.date,NAME:l.name,EXT:l.ext,LINK:l.link,GROUP:l.group,INDEX_GROUP:String(l.groupIndex),WIDTH:l.width,HEIGHT:l.height,DOMAIN:l.domain};let i=e.replace(/\{(PTITLE|ITEM_ID|DATE|NAME|EXT|LINK|GROUP|INDEX_GROUP|WIDTH|HEIGHT|DOMAIN)\}/g,(e,t)=>r[t]||e);i=i.replace(/\{NO\}/g,String(l.index));const s=i.match(/\{NO([\d]+)\}/);if(s){const e=s[1],t=e.length,n=l.index+parseInt(e,10),a=String(n).padStart(t,"0");i=i.replace(/\{NO[\d]+\}/g,a)}return i}async function l(e){if(e.startsWith("data:"))return Promise.resolve(e);const t=await fetch(e),n=await t.blob();return await new Promise(e=>{let t=new FileReader;t.onload=function(){e(t.result)},t.readAsDataURL(n)})}async function r(e,t){const n=await fetch(e).then(e=>e.blob()),a=await createImageBitmap(n);let o=Math.floor(t/a.width*a.height),l=new OffscreenCanvas(t,o),r=l.getContext("2d");r&&r.drawImage(a,0,0,t,o);let i=await l.convertToBlob({type:"image/jpeg"});return URL.createObjectURL(i)}function i(e){return`chrome-extension://${chrome.runtime.id}/_favicon/?pageUrl=${encodeURIComponent(e)}&size=24`}async function s(e){if(!function(e){return e.match("taobao.com|1688.com|tmall.com|jd.com|amazon|alibaba|aliexpress|dhgate|yangkeduo")}(e))return e;if(e.match("shop.+\\.1688\\.com")){const t=((await fetch(e).then(e=>e.text())).match("sellerId.*?:(\\d+)")||[])[1];return t&&(await fetch(`${a.RP}/api/ec/1688/getShopClickUrl?sellerId=${t}`).then(e=>e.json())).url||e}try{return(await fetch(`${a.RP}/api/ec?dest=${encodeURIComponent(e)}`).then(e=>e.json())).url}catch(t){return e}}},96921:(e,t,n)=>{n.d(t,{Pc:()=>d,RP:()=>s,V2:()=>r,Yd:()=>o,b6:()=>i,f3:()=>l,fw:()=>u,h4:()=>h,lK:()=>a,nD:()=>g,oE:()=>c,pO:()=>m});const a="CMD_SEARCH_EC",o="{PTITLE}/P_{NO001}.{EXT}",l="group_config",r="STORAGE_APP_CONFIG",i="stitch_imgs",s="https://fl.dakinl.com",c="https://ushangtech.com",d="/ec/transimage",u="dl_current_tab",m="search_img",g="Fatkun",h="https://www.fatkun.net"}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,loaded:!1,exports:{}};return l[e].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=l,e=[],i.O=(t,n,a,o)=>{if(!n){var l=1/0;for(d=0;d<e.length;d++){for(var[n,a,o]=e[d],r=!0,s=0;s<n.length;s++)(!1&o||l>=o)&&Object.keys(i.O).every(e=>i.O[e](n[s]))?n.splice(s--,1):(r=!1,o<l&&(l=o));if(r){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,a,o]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var o=Object.create(null);i.r(o);var l={};t=t||[null,n({}),n([]),n(n)];for(var r=2&a&&e;("object"==typeof r||"function"==typeof r)&&!~t.indexOf(r);r=n(r))Object.getOwnPropertyNames(r).forEach(t=>l[t]=()=>e[t]);return l.default=()=>e,i.d(o,l),o},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce((t,n)=>(i.f[n](e,t),t),[])),i.u=e=>e+".bundle.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a={},o="fatkun-v3:",i.l=(e,t,n,l)=>{if(a[e])a[e].push(t);else{var r,s;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==o+n){r=u;break}}r||(s=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,i.nc&&r.setAttribute("nonce",i.nc),r.setAttribute("data-webpack",o+n),r.src=e),a[e]=[t];var m=(t,n)=>{r.onerror=r.onload=null,clearTimeout(g);var o=a[e];if(delete a[e],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach(e=>e(n)),t)return t(n)},g=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),s&&document.head.appendChild(r)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),i.j=3436,i.p="/",(()=>{var e={3436:0};i.f.j=(t,n)=>{var a=i.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var o=new Promise((n,o)=>a=e[t]=[n,o]);n.push(a[2]=o);var l=i.p+i.u(t),r=new Error;i.l(l,n=>{if(i.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var o=n&&("load"===n.type?"missing":n.type),l=n&&n.target&&n.target.src;r.message="Loading chunk "+t+" failed.\n("+o+": "+l+")",r.name="ChunkLoadError",r.type=o,r.request=l,a[1](r)}},"chunk-"+t,t)}},i.O.j=t=>0===e[t];var t=(t,n)=>{var a,o,[l,r,s]=n,c=0;if(l.some(t=>0!==e[t])){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(s)var d=s(i)}for(t&&t(n);c<l.length;c++)o=l[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},n=self.webpackChunkfatkun_v3=self.webpackChunkfatkun_v3||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.nc=void 0;var s=i.O(void 0,[6163,9925,7684,8742,3061,8915,5652,5008,8311,5728,3732,4843,8555,5342,1321,2138,6830,5791,2974,2076],()=>i(3123));s=i.O(s)})();